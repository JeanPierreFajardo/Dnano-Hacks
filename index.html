<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asocia tu tarjeta</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #12090b;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .card {
      width: 360px;
      padding: 22px;
      border-radius: 12px;
      background: linear-gradient(180deg, #24171a, #1b1113);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
      font-size: 16px;
    }
    h1 {
      font-size: 22px;
      color: #f3b0b8;
      text-align: center;
      margin: 0 0 20px;
    }
    .inputbox {
      background: #1e1416;
      padding: 14px;
      border-radius: 8px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    input {
      width: 70%;
      padding: 10px;
      margin: 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      background-color: #2a1919;
      color: white;
      outline: none;
    }
    button {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      background: linear-gradient(90deg, #b9616d, #9a4b5b);
      color: #fff;
      cursor: pointer;
      font-size: 16px;
    }
    input:focus {
      background-color: #3a2323;
    }
    input::placeholder {
      color: #ccc;
    }
  </style>
</head>
<body>

<div class="card">
  <h1>Asocia tu tarjeta</h1>
  <form id="card-form" autocomplete="off">
    <div class="inputbox">
      <input type="text" name="card-number" id="card-number" placeholder="Número de tarjeta" autocomplete="cc-number" required />
    </div>
    <div class="inputbox">
      <input type="text" name="expiry-date" id="expiry-date" placeholder="MM/AA" autocomplete="cc-exp" required maxlength="5" oninput="this.value=this.value.replace(/[^0-9]/g,''); formatExpiryDate(this);" />
    </div>
    <button type="submit">Guardar tarjeta</button>
  </form>
</div>

<script>
// Formateo de la fecha (MM/AA) automáticamente
function formatExpiryDate(input) {
  let value = input.value;
  if (value.length === 2) {
    input.value = value + '/';
  }
}

// Clave pública de Stripe
const stripe = Stripe("pk_test_51SbnPOB6nHHlAyVvq1jLoCO4C2OvmhxZM9PXVgn0vSzGtBqMqSbuKK6mfjAXio9iiKUqGw02PUse4OwJeUlvMAMx001pwApenA");

const elements = stripe.elements();
const style = {
  base: { color: '#ffffff', fontSize: '16px', '::placeholder': { color: '#9a888a' } },
  invalid: { color: '#ff7a7a' }
};

const card = elements.create('card', { style });
card.mount('#card-number');

// Botón de Google Pay
const button = document.createElement('button');
button.textContent = "Guardar tarjeta con Google Pay";
button.classList.add('google-pay-button');  // Le damos clase para estilo
document.querySelector('form').appendChild(button);

// Agregar Google Pay con Stripe
button.addEventListener('click', async (e) => {
  e.preventDefault();
  const {token, error} = await stripe.createToken(card);
  
  if (error) {
    alert("Error al procesar la tarjeta: " + error.message);
    return;
  }

  // Aquí puedes procesar el token con tu servidor o backend
  console.log("Token de Stripe:", token);
  
  // Llamar a Google Pay API y manejar la asociación de la tarjeta
  try {
    const paymentDataRequest = {
      apiVersion: 2,
      apiVersionMinor: 0,
      allowedPaymentMethods: [
        {
          type: 'CARD',
          parameters: {
            allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
            allowedCardNetworks: ['MASTERCARD', 'VISA']
          },
          tokenizationSpecification: {
            type: 'PAYMENT_GATEWAY',
            parameters: {
              gateway: 'stripe',
              gatewayMerchantId: 'exampleGatewayMerchantId'
            }
          }
        }
      ]
    };

    const client = new google.payments.api.PaymentsClient({ environment: 'TEST' });

    client.loadPaymentData(paymentDataRequest)
      .then(function(paymentData) {
        // Aquí procesamos la información del pago con Google Pay
        console.log('Pago completado con Google Pay', paymentData);
        // Solo para fines demostrativos, puedes enviar esta data a tu backend
      })
      .catch(function(error) {
        console.error("Error con Google Pay:", error);
      });

  } catch (err) {
    console.error("Error con Google Pay:", err);
  }
});

// No hacer nada cuando se envíe el formulario, ya que Google Pay maneja la acción
const form = document.getElementById('card-form');
form.addEventListener('submit', function(e) {
  e.preventDefault();
});
</script>

</body>
</html>
